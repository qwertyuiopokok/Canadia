

<!DOCTYPE html>
<html lang="fr">
<head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Canadia - Recherche Avanc√©e</title>
        <style>
                body {
                        margin: 0;
                        font-family: system-ui, -apple-system, sans-serif;
                        background: #e0f7fa; /* Fond cyan clair comme l'image */
                        display: flex;
                        justify-content: center;
                        align-items: center;
                        min-height: 100vh;
                        padding: 20px;
                        box-sizing: border-box;
                }
                .search-container {
                        width: 100%;
                        max-width: 800px;
                        background: white;
                        border-radius: 20px;
                        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
                        overflow: hidden;
                }
                .main-search {
                        display: flex;
                        align-items: center;
                        padding: 20px;
                        background: linear-gradient(to right, #2979ff, #d50000); /* Gradient bleu ‚Üí rouge */
                }
                .main-search input {
                        flex: 1;
                        padding: 18px 24px;
                        font-size: 1.2rem;
                        border: none;
                        border-radius: 50px;
                        background: white;
                        margin-right: 15px;
                        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
                }
                .main-search button {
                        background: #d50000;
                        color: white;
                        border: none;
                        width: 50px;
                        height: 50px;
                        border-radius: 50%;
                        font-size: 1.5rem;
                        cursor: pointer;
                        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
                }
                .advanced-search {
                        padding: 30px;
                }
                .advanced-title {
                        text-transform: uppercase;
                        color: #666;
                        font-size: 0.9rem;
                        margin-bottom: 20px;
                        font-weight: 600;
                }
                .filters {
                        display: grid;
                        grid-template-columns: repeat(3, 1fr);
                        gap: 15px;
                        margin-bottom: 30px;
                }
                @media (max-width: 600px) {
                        .filters {
                                grid-template-columns: 1fr;
                        }
                }
                select {
                        padding: 12px 16px;
                        border: none;
                        border-radius: 50px;
                        background: #f0f0f0;
                        font-size: 1rem;
                        box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
                }
                .results-actions {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                }
                .results-count {
                        color: #666;
                        font-weight: 600;
                }
                .action-buttons {
                        display: flex;
                        gap: 15px;
                }
                button.reset {
                        background: none;
                        border: none;
                        color: #666;
                        font-size: 1rem;
                        cursor: pointer;
                        text-transform: uppercase;
                }
                button.search {
                        padding: 12px 30px;
                        background: linear-gradient(to right, #2979ff, #d50000);
                        color: white;
                        border: none;
                        border-radius: 50px;
                        font-size: 1rem;
                        cursor: pointer;
                        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
                }
        </style>
</head>
<body>
        <div class="search-container">
                <div class="main-search">
                        <input type="text" placeholder="Type Keywords">
                        <button>üîç</button>
                </div>
                <div class="advanced-search">
                        <div class="advanced-title">Advanced Search</div>
                        <div class="filters">
                                <select>
                                        <option>Accessories</option>
                                </select>
                                <select>
                                        <option>Color</option>
                                </select>
                                <select>
                                        <option>Size</option>
                                </select>
                                <select>
                                        <option>Sale</option>
                                </select>
                                <select>
                                        <option>Time</option>
                                </select>
                                <select>
                                        <option>Type</option>
                                </select>
                        </div>
                        <div class="results-actions">
                                <div class="results-count">108 results</div>
                                <div class="action-buttons">
                                        <button class="reset">Reset</button>
                                        <button class="search">Search</button>
                                </div>
                        </div>
                </div>
        </div>
</body>
</html>
                    function setMode(m) {
                            mode = m;
                            ["citizen", "student", "pro"].forEach(x => {
                                    document.getElementById("btn-" + x).classList.remove("active");
                            });
                            document.getElementById("btn-" + m).classList.add("active");
                            document.getElementById("context-card").style.display = (m === "student" || m === "pro") ? "block" : "none";
                    }

                    function toggleTheme() {
                            document.body.classList.toggle('dark');
                            localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
                    }

                    function loadHistory() {
                            const list = document.getElementById('history-list');
                            list.innerHTML = '';
                            history.forEach((q, i) => {
                                    const li = document.createElement('li');
                                    li.textContent = q.substring(0, 50) + '...';
                                    li.onclick = () => document.getElementById('question').value = q;
                                    list.appendChild(li);
                            });
                            document.getElementById('history-card').style.display = history.length ? 'block' : 'none';
                    }

                    function addToHistory(q) {
                            history.push(q);
                            if (history.length > 10) history.shift(); // Limite √† 10
                            localStorage.setItem('canadiaHistory', JSON.stringify(history));
                            loadHistory();
                    }

                    function copyResponse() {
                            const resp = document.getElementById('response').innerText;
                            navigator.clipboard.writeText(resp).then(() => alert('R√©ponse copi√©e !'));
                    }

                    async function ask() {
                            const q = document.getElementById('question').value.trim();
                            if (!q) {
                                    alert('Veuillez entrer une question valide.');
                                    return;
                            }
                            document.getElementById('loader').style.display = 'block';
                            document.getElementById('response-card').style.display = 'none';
                            try {
                                    addToHistory(q);
                                    const context = document.getElementById('context').value; // Ajoute contexte si visible
                                    const body = { question: q, context }; // Envoie contexte au backend
                                    const res = await fetch(`http://127.0.0.1:9000/${mode}/ask`, {
                                            method: "POST",
                                            headers: { "Content-Type": "application/json" },
                                            body: JSON.stringify(body)
                                    });
                                    if (!res.ok) throw new Error('Erreur r√©seau');
                                    const data = await res.json();
                                    if (!data || Object.keys(data).length === 0) {
                                            document.getElementById('response').textContent = "Aucune r√©ponse disponible. Veuillez reformuler votre question ou r√©essayer plus tard.";
                                            return;
                                    }
                                    let html = "";
                                    if (data.title) html += `<strong>üß† ${data.title}</strong><br><br>`;
                                    if (data.summary) html += `<b>R√©sum√© :</b><br>${data.summary}<br><br>`;
                                    if (data.key_points && data.key_points.length) html += `<b>Points cl√©s :</b><ul>` + data.key_points.map(pt => `<li>${pt}</li>`).join("") + `</ul><br>`;
                                    if (data.analysis) html += `<b>Analyse :</b><br>${data.analysis}<br><br>`;
                                    if (data.actions_or_reflections && data.actions_or_reflections.length) html += `<b>Pour aller plus loin :</b><ul>` + data.actions_or_reflections.map(q => `<li>${q}</li>`).join("") + `</ul><br>`;
                                    if (data.sources && data.sources.length) html += `<b>Sources :</b><ul>` + data.sources.map(s => `<li>${s}</li>`).join("") + `</ul><br>`;
                                    if (data.limits) html += `<b>Limites :</b><br>${data.limits}<br><br>`;
                                    if (data.disclaimer) html += `<b>Note :</b> ${data.disclaimer}<br>`;
                                    document.getElementById('response').innerHTML = html || "Aucune r√©ponse structur√©e re√ßue.";
                                    document.getElementById('response-card').style.display = 'block';
                            } catch (e) {
                                    document.getElementById('response').textContent = `Erreur : ${e.message}. V√©rifiez le backend.`;
                                    document.getElementById('response-card').style.display = 'block';
                            } finally {
                                    document.getElementById('loader').style.display = 'none';
                            }
                    }

                    // Init
                    if (localStorage.getItem('theme') === 'dark') toggleTheme();
                    document.getElementById('theme-toggle').onclick = toggleTheme;
                    loadHistory();
            </script>
    </body>
    </html>
            document.getElementById("btn-" + m).classList.add("active");
            document.getElementById("context-card").style.display = (m === "student" || m === "pro") ? "block" : "none";
        }

        function toggleTheme() {
            document.body.classList.toggle('dark');
            localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
        }

        function loadHistory() {
            const list = document.getElementById('history-list');
            list.innerHTML = '';
            history.forEach((q, i) => {
                const li = document.createElement('li');
                li.textContent = q.substring(0, 50) + '...';
                li.onclick = () => document.getElementById('question').value = q;
                list.appendChild(li);
            });
            document.getElementById('history-card').style.display = history.length ? 'block' : 'none';
        }

        function addToHistory(q) {
            history.push(q);
            if (history.length > 10) history.shift(); // Limite √† 10
            localStorage.setItem('canadiaHistory', JSON.stringify(history));
            loadHistory();
        }

        function copyResponse() {
            const resp = document.getElementById('response').innerText;
            navigator.clipboard.writeText(resp).then(() => alert('R√©ponse copi√©e !'));
        }

        async function ask() {
            const q = document.getElementById('question').value.trim();
            if (!q) {
                alert('Veuillez entrer une question valide.');
                return;
            }
            document.getElementById('loader').style.display = 'block';
            document.getElementById('response-card').style.display = 'none';
            try {
                addToHistory(q);
                const context = document.getElementById('context').value; // Ajoute contexte si visible
                const body = { question: q, context }; // Envoie contexte au backend
                const res = await fetch(`http://127.0.0.1:9000/${mode}/ask`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(body)
                });
                if (!res.ok) throw new Error('Erreur r√©seau');
                const data = await res.json();
                if (!data || Object.keys(data).length === 0) {
                    document.getElementById('response').textContent = "Aucune r√©ponse disponible. Veuillez reformuler votre question ou r√©essayer plus tard.";
                    return;
                }
                let html = "";
                if (data.title) html += `<strong>üß† ${data.title}</strong><br><br>`;
                if (data.summary) html += `<b>R√©sum√© :</b><br>${data.summary}<br><br>`;
                if (data.key_points && data.key_points.length) html += `<b>Points cl√©s :</b><ul>` + data.key_points.map(pt => `<li>${pt}</li>`).join("") + `</ul><br>`;
                if (data.analysis) html += `<b>Analyse :</b><br>${data.analysis}<br><br>`;
                if (data.actions_or_reflections && data.actions_or_reflections.length) html += `<b>Pour aller plus loin :</b><ul>` + data.actions_or_reflections.map(q => `<li>${q}</li>`).join("") + `</ul><br>`;
                if (data.sources && data.sources.length) html += `<b>Sources :</b><ul>` + data.sources.map(s => `<li>${s}</li>`).join("") + `</ul><br>`;
                if (data.limits) html += `<b>Limites :</b><br>${data.limits}<br><br>`;
                if (data.disclaimer) html += `<b>Note :</b> ${data.disclaimer}<br>`;
                document.getElementById('response').innerHTML = html || "Aucune r√©ponse structur√©e re√ßue.";
                document.getElementById('response-card').style.display = 'block';
            } catch (e) {
                document.getElementById('response').textContent = `Erreur : ${e.message}. V√©rifiez le backend.`;
                document.getElementById('response-card').style.display = 'block';
            } finally {
                document.getElementById('loader').style.display = 'none';
            }
        }

        // Init
        if (localStorage.getItem('theme') === 'dark') toggleTheme();
        document.getElementById('theme-toggle').onclick = toggleTheme;
        loadHistory();
    </script>
</body>
</html>
