

<!DOCTYPE html>
<html lang="fr">
<head>
<!DOCTYPE html>
<html lang="fr">
<head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Canadia ‚Äî Comprendre. Structurer. D√©cider.</title>
        <style>
                :root {
                        --primary: #d32f2f;     /* Rouge canadien profond */
                        --secondary: #f44336;   /* Rouge vif */
                        --accent: #ffeb3b;      /* Jaune contrast√© pour hover */
                        --bg: #ffffff;
                        --surface: #f8f9fa;
                        --text: #212121;
                        --muted: #666666;
                }
                body.dark {
                        --bg: #121212;
                        --surface: #1e1e1e;
                        --text: #f5f5f5;
                        --muted: #aaaaaa;
                }
                body {
                        margin: 0;
                        font-family: system-ui, -apple-system, sans-serif;
                        background: var(--bg);
                        color: var(--text);
                        min-height: 100vh;
                        display: flex;
                        flex-direction: column;
                        transition: all 0.3s;
                }
                header {
                        background: var(--primary);
                        color: white;
                        padding: 2rem 1rem;
                        text-align: center;
                        box-shadow: 0 4px 20px rgba(211,47,47,0.2);
                }
                .title {
                        font-size: 2.8rem;
                        font-weight: 700;
                        margin: 0;
                }
                .subtitle {
                        font-size: 1.2rem;
                        opacity: 0.9;
                        margin: 0.5rem 0 1.5rem;
                }
                .mode-selector {
                        display: flex;
                        justify-content: center;
                        gap: 1rem;
                        flex-wrap: wrap;
                }
                .mode-btn {
                        padding: 0.8rem 2rem;
                        background: rgba(255,255,255,0.2);
                        border: none;
                        border-radius: 50px;
                        color: white;
                        font-size: 1.1rem;
                        cursor: pointer;
                        transition: all 0.3s;
                }
                .mode-btn.active {
                        background: white;
                        color: var(--primary);
                        font-weight: 600;
                }
                main {
                        flex: 1;
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        justify-content: center;
                        padding: 2rem;
                }
                .search-box {
                        width: 100%;
                        max-width: 800px;
                        padding: 1.5rem 2rem;
                        font-size: 1.4rem;
                        border: 4px solid var(--secondary);
                        border-radius: 50px;
                        background: var(--surface);
                        color: var(--text);
                        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
                        outline: none;
                        transition: border-color 0.3s;
                }
                .search-box:focus {
                        border-color: var(--accent);
                }
                .search-btn {
                        margin-top: 2rem;
                        padding: 1.2rem 4rem;
                        font-size: 1.3rem;
                        background: var(--primary);
                        color: white;
                        border: none;
                        border-radius: 50px;
                        cursor: pointer;
                        box-shadow: 0 8px 25px rgba(211,47,47,0.3);
                        transition: all 0.3s;
                }
                .search-btn:hover {
                        background: var(--secondary);
                        transform: translateY(-2px);
                }
                #theme-toggle {
                        position: absolute;
                        top: 1.5rem;
                        right: 1.5rem;
                        background: none;
                        border: none;
                        font-size: 1.8rem;
                        cursor: pointer;
                        color: white;
                }
                .hint {
                        margin-top: 1.5rem;
                        font-size: 1.1rem;
                        color: var(--muted);
                }
                @media (max-width: 600px) {
                        .title { font-size: 2.2rem; }
                        .search-box { font-size: 1.2rem; padding: 1.2rem; }
                        .mode-btn { padding: 0.7rem 1.5rem; }
                }
        </style>
</head>
<body>
        <header>
                <button id="theme-toggle" aria-label="Th√®me sombre/clair">üåô</button>
                <h1 class="title">Canadia</h1>
                <p class="subtitle">Comprendre. Structurer. D√©cider.</p>
                <div class="mode-selector">
                        <button class="mode-btn active" onclick="setMode('citizen')">Citoyen</button>
                        <button class="mode-btn" onclick="setMode('student')">√âtudiant</button>
                        <button class="mode-btn" onclick="setMode('pro')">Entreprise</button>
                </div>
        </header>

        <main>
                <input type="text" class="search-box" id="query" placeholder="Posez votre question ou recherchez un sujet..." autocomplete="off" />
                <p class="hint" id="mode-hint">Recherche g√©n√©rale pour tous les citoyens</p>
                <button class="search-btn" onclick="search()">Rechercher avec Canadia</button>
        </main>

        <script>
                let currentMode = 'citizen';
                const hints = {
                        citizen: "Recherche g√©n√©rale pour tous les citoyens",
                        student: "Analyse adapt√©e au contexte universitaire et √©tudiant",
                        pro: "Analyse strat√©gique pour entreprises et organisations"
                };

                function setMode(mode) {
                        currentMode = mode;
                        document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                        event.target.classList.add('active');
                        document.getElementById('mode-hint').textContent = hints[mode];
                }

                function search() {
                        const query = document.getElementById('query').value.trim();
                        if (!query) return alert('Entrez une question !');
                        // √Ä connecter au backend plus tard : fetch(`/api/${currentMode}/ask`, ...)
                        alert(`Recherche "${query}" en mode ${currentMode} (bient√¥t : r√©sultats structur√©s)`);
                }

                // Th√®me sombre/clair
                document.getElementById('theme-toggle').onclick = () => {
                        document.body.classList.toggle('dark');
                        const isDark = document.body.classList.contains('dark');
                        localStorage.setItem('theme', isDark ? 'dark' : 'light');
                        document.getElementById('theme-toggle').textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
                };
                if (localStorage.getItem('theme') === 'dark') {
                        document.body.classList.add('dark');
                        document.getElementById('theme-toggle').textContent = '‚òÄÔ∏è';
                }
        </script>
</body>
</html>
        </style>
</head>
<body>
        <div class="search-container">
                <div class="main-search">
                        <input type="text" placeholder="Type Keywords">
                        <button>üîç</button>
                </div>
                <div class="advanced-search">
                        <div class="advanced-title">Advanced Search</div>
                        <div class="filters">
                                <select>
                                        <option>Accessories</option>
                                </select>
                                <select>
                                        <option>Color</option>
                                </select>
                                <select>
                                        <option>Size</option>
                                </select>
                                <select>
                                        <option>Sale</option>
                                </select>
                                <select>
                                        <option>Time</option>
                                </select>
                                <select>
                                        <option>Type</option>
                                </select>
                        </div>
                        <div class="results-actions">
                                <div class="results-count">108 results</div>
                                <div class="action-buttons">
                                        <button class="reset">Reset</button>
                                        <button class="search">Search</button>
                                </div>
                        </div>
                </div>
        </div>
</body>
</html>
                    function setMode(m) {
                            mode = m;
                            ["citizen", "student", "pro"].forEach(x => {
                                    document.getElementById("btn-" + x).classList.remove("active");
                            });
                            document.getElementById("btn-" + m).classList.add("active");
                            document.getElementById("context-card").style.display = (m === "student" || m === "pro") ? "block" : "none";
                    }

                    function toggleTheme() {
                            document.body.classList.toggle('dark');
                            localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
                    }

                    function loadHistory() {
                            const list = document.getElementById('history-list');
                            list.innerHTML = '';
                            history.forEach((q, i) => {
                                    const li = document.createElement('li');
                                    li.textContent = q.substring(0, 50) + '...';
                                    li.onclick = () => document.getElementById('question').value = q;
                                    list.appendChild(li);
                            });
                            document.getElementById('history-card').style.display = history.length ? 'block' : 'none';
                    }

                    function addToHistory(q) {
                            history.push(q);
                            if (history.length > 10) history.shift(); // Limite √† 10
                            localStorage.setItem('canadiaHistory', JSON.stringify(history));
                            loadHistory();
                    }

                    function copyResponse() {
                            const resp = document.getElementById('response').innerText;
                            navigator.clipboard.writeText(resp).then(() => alert('R√©ponse copi√©e !'));
                    }

                    async function ask() {
                            const q = document.getElementById('question').value.trim();
                            if (!q) {
                                    alert('Veuillez entrer une question valide.');
                                    return;
                            }
                            document.getElementById('loader').style.display = 'block';
                            document.getElementById('response-card').style.display = 'none';
                            try {
                                    addToHistory(q);
                                    const context = document.getElementById('context').value; // Ajoute contexte si visible
                                    const body = { question: q, context }; // Envoie contexte au backend
                                    const res = await fetch(`http://127.0.0.1:9000/${mode}/ask`, {
                                            method: "POST",
                                            headers: { "Content-Type": "application/json" },
                                            body: JSON.stringify(body)
                                    });
                                    if (!res.ok) throw new Error('Erreur r√©seau');
                                    const data = await res.json();
                                    if (!data || Object.keys(data).length === 0) {
                                            document.getElementById('response').textContent = "Aucune r√©ponse disponible. Veuillez reformuler votre question ou r√©essayer plus tard.";
                                            return;
                                    }
                                    let html = "";
                                    if (data.title) html += `<strong>üß† ${data.title}</strong><br><br>`;
                                    if (data.summary) html += `<b>R√©sum√© :</b><br>${data.summary}<br><br>`;
                                    if (data.key_points && data.key_points.length) html += `<b>Points cl√©s :</b><ul>` + data.key_points.map(pt => `<li>${pt}</li>`).join("") + `</ul><br>`;
                                    if (data.analysis) html += `<b>Analyse :</b><br>${data.analysis}<br><br>`;
                                    if (data.actions_or_reflections && data.actions_or_reflections.length) html += `<b>Pour aller plus loin :</b><ul>` + data.actions_or_reflections.map(q => `<li>${q}</li>`).join("") + `</ul><br>`;
                                    if (data.sources && data.sources.length) html += `<b>Sources :</b><ul>` + data.sources.map(s => `<li>${s}</li>`).join("") + `</ul><br>`;
                                    if (data.limits) html += `<b>Limites :</b><br>${data.limits}<br><br>`;
                                    if (data.disclaimer) html += `<b>Note :</b> ${data.disclaimer}<br>`;
                                    document.getElementById('response').innerHTML = html || "Aucune r√©ponse structur√©e re√ßue.";
                                    document.getElementById('response-card').style.display = 'block';
                            } catch (e) {
                                    document.getElementById('response').textContent = `Erreur : ${e.message}. V√©rifiez le backend.`;
                                    document.getElementById('response-card').style.display = 'block';
                            } finally {
                                    document.getElementById('loader').style.display = 'none';
                            }
                    }

                    // Init
                    if (localStorage.getItem('theme') === 'dark') toggleTheme();
                    document.getElementById('theme-toggle').onclick = toggleTheme;
                    loadHistory();
            </script>
    </body>
    </html>
            document.getElementById("btn-" + m).classList.add("active");
            document.getElementById("context-card").style.display = (m === "student" || m === "pro") ? "block" : "none";
        }

        function toggleTheme() {
            document.body.classList.toggle('dark');
            localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
        }

        function loadHistory() {
            const list = document.getElementById('history-list');
            list.innerHTML = '';
            history.forEach((q, i) => {
                const li = document.createElement('li');
                li.textContent = q.substring(0, 50) + '...';
                li.onclick = () => document.getElementById('question').value = q;
                list.appendChild(li);
            });
            document.getElementById('history-card').style.display = history.length ? 'block' : 'none';
        }

        function addToHistory(q) {
            history.push(q);
            if (history.length > 10) history.shift(); // Limite √† 10
            localStorage.setItem('canadiaHistory', JSON.stringify(history));
            loadHistory();
        }

        function copyResponse() {
            const resp = document.getElementById('response').innerText;
            navigator.clipboard.writeText(resp).then(() => alert('R√©ponse copi√©e !'));
        }

        async function ask() {
            const q = document.getElementById('question').value.trim();
            if (!q) {
                alert('Veuillez entrer une question valide.');
                return;
            }
            document.getElementById('loader').style.display = 'block';
            document.getElementById('response-card').style.display = 'none';
            try {
                addToHistory(q);
                const context = document.getElementById('context').value; // Ajoute contexte si visible
                const body = { question: q, context }; // Envoie contexte au backend
                const res = await fetch(`http://127.0.0.1:9000/${mode}/ask`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(body)
                });
                if (!res.ok) throw new Error('Erreur r√©seau');
                const data = await res.json();
                if (!data || Object.keys(data).length === 0) {
                    document.getElementById('response').textContent = "Aucune r√©ponse disponible. Veuillez reformuler votre question ou r√©essayer plus tard.";
                    return;
                }
                let html = "";
                if (data.title) html += `<strong>üß† ${data.title}</strong><br><br>`;
                if (data.summary) html += `<b>R√©sum√© :</b><br>${data.summary}<br><br>`;
                if (data.key_points && data.key_points.length) html += `<b>Points cl√©s :</b><ul>` + data.key_points.map(pt => `<li>${pt}</li>`).join("") + `</ul><br>`;
                if (data.analysis) html += `<b>Analyse :</b><br>${data.analysis}<br><br>`;
                if (data.actions_or_reflections && data.actions_or_reflections.length) html += `<b>Pour aller plus loin :</b><ul>` + data.actions_or_reflections.map(q => `<li>${q}</li>`).join("") + `</ul><br>`;
                if (data.sources && data.sources.length) html += `<b>Sources :</b><ul>` + data.sources.map(s => `<li>${s}</li>`).join("") + `</ul><br>`;
                if (data.limits) html += `<b>Limites :</b><br>${data.limits}<br><br>`;
                if (data.disclaimer) html += `<b>Note :</b> ${data.disclaimer}<br>`;
                document.getElementById('response').innerHTML = html || "Aucune r√©ponse structur√©e re√ßue.";
                document.getElementById('response-card').style.display = 'block';
            } catch (e) {
                document.getElementById('response').textContent = `Erreur : ${e.message}. V√©rifiez le backend.`;
                document.getElementById('response-card').style.display = 'block';
            } finally {
                document.getElementById('loader').style.display = 'none';
            }
        }

        // Init
        if (localStorage.getItem('theme') === 'dark') toggleTheme();
        document.getElementById('theme-toggle').onclick = toggleTheme;
        loadHistory();
    </script>
</body>
</html>
